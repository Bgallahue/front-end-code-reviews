<template>
    <lightning-card title="Nearby Records">
        <c-loading-spinner if:true={isLoading} type="absolute"></c-loading-spinner>
        <div slot="actions">
            <lightning-button-icon
                icon-name="standard:address"
                variant="bare"
                size="large"
                title="Open Map"
                onclick={handleOpenMap}
            ></lightning-button-icon>
        </div>
        <div if:true={listData.hasNoRecords} class="slds-p-horizontal_small">
            <p>
                There currently are no vetted partners in this area. Click on the “Partner Request Cases” tab to check if a recent
                request was made. If no request was made within the last 60 days, feel free to submit a new case to the Partner
                Development team
            </p>
        </div>
        <lightning-tabset active-tab-value="list">
            <lightning-tab label="List" value="list" icon-name="utility:list">
                <template for:each={listData.accounts} for:item="account">
                    <div key={account.Id} class="slds-card_boundary slds-p-horizontal_small">
                        <lightning-card>
                            <div class="slds-grid">
                                <div class="slds-col">
                                    <p>
                                        <lightning-formatted-url
                                            value={account.url}
                                            label={account.name}
                                            target="_self"
                                        ></lightning-formatted-url>
                                    </p>
                                </div>
                                <div class="slds-col slds-text-align_right"><p>{account.distance} mi</p></div>
                            </div>
                            <p>Primary Billing Contact Name: {account.primaryBillingContactName}</p>
                            <p>Services: {account.services}</p>
                            <p>Year Company Established: {account.yearEstablished}</p>
                            <p>Years with Evolve: {account.yearsWithEvolve}</p>
                            <p>Partner Active Listings: {account.partnerActiveListings}</p>
                            <lightning-accordion allow-multiple-sections-open>
                                <lightning-accordion-section key={account.Id} name={account.Name} label="Expand Account">
                                    <p>Type: {account.type}</p>
                                    <p>Bio: {account.bio}</p>
                                    <p>Website: {account.website}</p>
                                    <p>Address: {account.fullAddress}</p>
                                    <template for:each={account.partnerServices} for:item="service">
                                        <div
                                            key={service.Id}
                                            class="slds-card_boundary slds-m-bottom_xx-small slds-var-p-around_small"
                                        >
                                            <lightning-card>
                                                <p>
                                                    <lightning-formatted-url
                                                        value={service.url}
                                                        label={service.name}
                                                        target="_self"
                                                    ></lightning-formatted-url>
                                                </p>
                                                <p>Partner Service: {service.service}</p>
                                                <p>Partner Rate Structure: {service.rateStructure}</p>
                                                <p>Partner Fee Type: {service.feeType}</p>
                                                <p>{service.flatRate}</p>
                                                <p>{service.percentRate}</p>
                                            </lightning-card>
                                        </div>
                                    </template>
                                </lightning-accordion-section>
                            </lightning-accordion>
                        </lightning-card>
                    </div>
                </template>
            </lightning-tab>
            <lightning-tab label="Map" value="map" icon-name="standard:location">
                <lightning-map markers-title="Partners" map-markers={mapMarkers}> </lightning-map>
            </lightning-tab>
            <lightning-tab label="Partner Request Cases" value="case" icon-name="standard:location">
                <iframe width="100%" height="500" src={caseUrl} scrolling="true"></iframe>
            </lightning-tab>
        </lightning-tabset>
    </lightning-card>
</template>