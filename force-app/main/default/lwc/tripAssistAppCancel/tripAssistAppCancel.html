<template>
    <div if:false={isResultVisible}>
        <c-trip-assist-header
                record-id={recordId}
                action={ACTION}
        ></c-trip-assist-header>

        <div class="slds-grid slds-p-top_medium slds-p-bottom_x-large">
            <div class="slds-col slds-size_3-of-5 slds-p-right_medium">
                <article class="slds-card">

                    <div class="slds-p-vertical_medium slds-p-horizontal_large slds-border_bottom">
                        <header class="slds-grid slds-grid_vertical-align-center">
                            <div class="evolve-lex_icon evolve-lex_icon-circle evolve-lex_icon-default slds-current-color slds-m-right_medium">
                                <lightning-icon
                                        icon-name="utility:ban"
                                        size="small"
                                ></lightning-icon>
                            </div>
                            <h2 class="slds-card__header-title slds-grow">Cancellation Details</h2>
                        </header>

                        <div class="slds-m-top_x-small">Make any adjustments to the details of the booking cancellation here. If you want to see any changes made reflected in the Line Items press “View Refund Adjustments.”</div>
                    </div>


                    <div class="slds-p-horizontal_large">

                        <div class="slds-p-vertical_x-large slds-border_bottom" onchange={handleChange}>
                            <div class="slds-text-heading_medium slds-m-bottom_medium">Responsibility and Reason</div>

                            <div class="slds-grid slds-gutters_direct">
                                <div class="slds-col slds-size_1-of-2">
                                    <lightning-combobox
                                            name="responsibility"
                                            label="Who is responsible for this cancellation?"
                                            value={form.responsibility}
                                            placeholder="Select..."
                                            options={responsibilityOptions}
                                    ></lightning-combobox>
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <lightning-combobox
                                            name="reason"
                                            label="Cancellation Reason"
                                            value={form.reason}
                                            placeholder="Select..."
                                            options={reasonOptions}
                                            required
                                    ></lightning-combobox>
                                </div>
                            </div>


                            <lightning-radio-group
                                    if:true={isOwner}
                                    type="button"
                                    label="Owner Cancellation Fee"
                                    name="cancellationFee"
                                    value={form.cancellationFee}
                                    options={cancellationFeeOptions}
                                    class="slds-m-top_medium"
                                    required
                            ></lightning-radio-group>

                            <lightning-radio-group
                                    if:true={isEvolve}
                                    type="button"
                                    label="Owner payout"
                                    name="ownerPayout"
                                    value={form.ownerPayout}
                                    options={ownerPayoutOptions}
                                    class="slds-m-top_medium"
                                    required
                            ></lightning-radio-group>
                        </div>

                        <div
                                if:true={refund}
                                class="slds-p-vertical_x-large slds-border_bottom"
                        >
                            <div class="slds-text-heading_medium slds-m-bottom_medium">Refund Details</div>
                            <p>{refund.copy}</p>

                            <!--<div class="slds-m-top_large slds-m-bottom_medium">-->
                            <div class="slds-grid slds-grid_align-spread slds-m-top_large">
                                <lightning-input
                                        type="number"
                                        label="Credit Card Refund"
                                        value={refund.cash}
                                        formatter="currency"
                                        readonly
                                ></lightning-input>
                                <lightning-input
                                        type="number"
                                        label="FTC Issue"
                                        value={refund.ftc}
                                        formatter="currency"
                                        readonly
                                ></lightning-input>
                                <!--<c-dual-input-slider
                                        left-value={refund.cash}
                                        right-value={refund.ftc}
                                        left-type="currency"
                                        right-type="number"
                                        left-label="Credit Card Refund"
                                        right-label="FTC Issue"
                                        border-color="#854592"
                                        slider-color="#854592"
                                        onchange={handleDualInputChange}
                                ></c-dual-input-slider>-->
                            </div>

                            <!-- REFUND FROM ORIGINAL BOOKING WARNING ALERT -->
                            <!--<div
                                    if:true={isRefundFromOriginalBookingVisible.warningSection}
                                    class="evolve-lex_alert evolve-lex_alert-warning slds-m-bottom_large"
                            >
                                <h2 class="evolve-lex_alert-title slds-m-bottom_small">Refund from Original Booking</h2>
                                <div class="slds-m-bottom_medium">
                                    <p class="slds-m-bottom_medium">This booking was paid for with FTC issued to the guest as a result of a previous booking (Booking 234567) being cancelled by Evolve.</p>
                                    <p><b>Would you like to refund from the original booking?</b></p>
                                </div>

                                <div class="slds-text-align_right">
                                    <lightning-button
                                            label="Yes"
                                            variant="brand"
                                            onclick={handleRefundFromOriginalBooking}
                                    ></lightning-button>
                                </div>
                            </div>-->

                            <!-- REFUND FROM ORIGINAL BOOKING SUCCESS ALERT -->
                            <!--<div
                                    if:true={isRefundFromOriginalBookingVisible.successSection}
                                    class="evolve-lex_alert evolve-lex_alert-success slds-m-bottom_large"
                            >
                                <h2 class="evolve-lex_alert-title slds-m-bottom_small">Refund from Original Booking</h2>
                                <div class="slds-m-bottom_medium">
                                    <p>This cancellation is being refunded from the original booking (Booking 234567).</p>
                                </div>

                                <div class="slds-text-align_right">
                                    <lightning-button
                                            label="Revert to Current Booking"
                                            variant="base"
                                            onclick={handleRevertToCurrentBooking}
                                    ></lightning-button>
                                </div>
                            </div>-->

                        </div>

                        <div class="slds-p-vertical_x-large">
                            <div class="slds-text-heading_medium slds-m-bottom_large">Credit Card on File</div>
                            <div class="slds-grid slds-text-title_caps trip-assist-app-cancel_credit-card">
                                <div class="slds-m-right_x-large">{booking.Payment_Method__r.bt_stripe__Brand__c}</div>
                                <div class="slds-m-right_x-large">****{booking.Payment_Method__r.bt_stripe__Card_Last_4_Digit__c}</div>
                                <div class="slds-m-right_x-large">{booking.Payment_Method__r.bt_stripe__Card_Expiration_Month__c}/{booking.Payment_Method__r.bt_stripe__Card_Expiration_Year__c}</div>
                            </div>
                        </div>

                    </div>


                    <div class="slds-p-vertical_medium slds-p-horizontal_large slds-border_top">
                        <div class="slds-grid slds-grid_align-end">

                            <lightning-button
                                    variant="neutral"
                                    label="View Refund Adjustments"
                                    onclick={handleRefresh}
                                    class="slds-m-right_medium"
                                    disabled={isDisabledRefresh}
                            ></lightning-button>

                            <lightning-button
                                    variant="brand"
                                    label="Cancel Booking"
                                    onclick={handleSubmit}
                                    disabled={isDisabledSubmit}
                            ></lightning-button>

                        </div>
                    </div>

                </article>
            </div>

            <div class="slds-col slds-size_2-of-5">
                <c-trip-assist-line-items
                        record-id={recordId}
                        refresh-required={isRefreshRequired}
                        onrefresh={handleRefresh}
                ></c-trip-assist-line-items>
            </div>

        </div>

        <c-loading-spinner if:true={isLoading} type="overlay"></c-loading-spinner>

        <!--CANCEL BOOKING EMAIL MODAL-->

        <div if:true={isConfirmationModalOpen}>
            <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container trip-assist-cancel-booking-email-modal_container">

                    <header class="slds-modal__header trip-assist-cancel-booking-email-modal_header">
                        <lightning-button-icon
                                icon-name="utility:close"
                                variant="bare-inverse"
                                size="large"
                                class="slds-modal__close"
                                onclick={handleCloseConfirmationModal}
                        ></lightning-button-icon>
                        <h2 class="slds-modal__title slds-hyphenate trip-assist-cancel-booking-email-modal_header-title">Cancel Booking</h2>
                    </header>

                    <div class="slds-modal__content slds-p-horizontal_large slds-p-vertical_x-large slds-text-heading_medium" onchange={handleSendEmailsChange}>

                        <p>Are you sure you want to cancel this booking?</p>

                        <div class="slds-grid slds-p-top_large">
                            <div>
                                <p class="slds-text-heading_small">Booking Number</p>
                                <p>1234567</p>
                            </div>
                            <div class="slds-p-horizontal_x-large">
                                <p class="slds-text-heading_small">Check-In</p>
                                <p>Thu, Sep 2, 2021</p>
                            </div>
                            <div>
                                <p class="slds-text-heading_small">Check-Out</p>
                                <p>Sun, Sep 5, 2021</p>
                            </div>
                        </div>

                        <div class="slds-border_top slds-m-vertical_x-large"><!-- SEPARATOR --></div>

                        <div class="slds-p-bottom_large slds-grid slds-grid_align-spread slds-size_5-of-8">
                            <span>Do you want all emails to send automatically?</span>
                            <lightning-input
                                    checked={sendEmailsTo.all}
                                    type="toggle"
                                    name="all"
                                    message-toggle-active="Yes"
                                    message-toggle-inactive="No"
                            ></lightning-input>
                        </div>

                        <div class="slds-box slds-p-around_large slds-size_5-of-8 ">
                            <div class="slds-grid slds-grid_align-end">
                                <span>Send <b>Guest</b> emails automatically?</span>
                                <lightning-input
                                        checked={sendEmailsTo.guest}
                                        type="toggle"
                                        name="guest"
                                        message-toggle-active="Yes"
                                        message-toggle-inactive="No"
                                ></lightning-input>
                            </div>
                            <div class="slds-grid slds-grid_align-end slds-p-vertical_medium">
                                <span>Send <b>Owner</b> emails automatically?</span>
                                <lightning-input
                                        checked={sendEmailsTo.owner}
                                        type="toggle"
                                        name="owner"
                                        message-toggle-active="Yes"
                                        message-toggle-inactive="No"
                                ></lightning-input>
                            </div>
                            <div class="slds-grid slds-grid_align-end">
                                <span>Send <b>Partner</b> emails automatically?</span>
                                <lightning-input
                                        checked={sendEmailsTo.partner}
                                        type="toggle"
                                        name="partner"
                                        message-toggle-active="Yes"
                                        message-toggle-inactive="No"
                                ></lightning-input>
                            </div>
                        </div>

                    </div>

                    <footer class="slds-modal__footer trip-assist-cancel-booking-email-modal_footer slds-grid slds-grid_align-spread slds-theme_default">
                        <button
                                class="slds-button slds-button_neutral trip-assist-cancel-booking-email-modal_button-neutral"
                                onclick={handleCloseConfirmationModal}
                        >Nevermind</button>
                        <button
                                class="slds-button slds-button_destructive trip-assist-cancel-booking-email-modal_button-destructive"
                                onclick={handleSubmit}
                        >Yes, Cancel Booking</button>
                    </footer>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </div>
    </div>
    <c-trip-assist-results-screen
        if:true={isResultVisible}
        record-id={recordId}
        refund={refund}
        variant="cancel"
        booking={booking}
        onback={handleHideResults}
    ></c-trip-assist-results-screen>

</template>